---
title: AI 建议扩展配置选项
meta:
  title: 配置 AI 建议 | Tiptap AI 建议
  description: 用规则、初始建议和自定义样式配置 AI 建议扩展。
  category: 内容 AI
---

Tiptap 的 AI 建议扩展接受不同的设置，以配置扩展和命令的全局行为。

## 规则

在校对过程中应用的一组规则。每个规则包含

- 唯一的 `id`
- `prompt` 属性，该文本将由 AI 模型读取以生成建议
- 决定规则在 UI 中如何显示的参数，如 `title`、`color` 和 `backgroundColor`

您可以随时更改规则，无需重新加载编辑器，使用 `setAiSuggestionRules` 命令。

```ts
AiSuggestion.configure({
  rules: [
    {
      id: '1',
      title: '拼写检查',
      prompt: '识别并纠正任何拼写错误',
      color: '#DC143C',
      backgroundColor: 'FFE6E6',
    },
  ],
})
```

您可以在此指南中了解更多关于规则的信息： [定义规则](/content-ai/capabilities/suggestion/features/define-rules)

## 初始建议

在进行任何校对之前展示的一组初始建议。这可以作为性能优化，避免等待首次生成建议。

```ts
export const suggestions: Suggestion[] = [
  {
    id: '1',
    deleteRange: { from: 1, to: 5 },
    deleteText: 'Mistaek',
    replacementOptions: [
      {
        id: '1',
        addText: 'Mistake',
      },
    ],
    rule: {
      id: '1',
      title: '拼写检查',
      prompt: '识别并纠正任何拼写错误',
      color: '#DC143C',
      backgroundColor: 'FFE6E6',
    },
    isRejected: false,
  },
]

AiSuggestion.configure({
  initialSuggestions: suggestions,
})
```

要了解建议对象应包含的数据，请查看 [API 参考](/content-ai/capabilities/suggestion/api-reference#proofreading-suggestions)。

## 自定义建议样式

`getCustomSuggestionDecoration` 函数允许您控制建议的外观并为用户提供视觉提示。您可以为建议添加自定义 CSS 类，并在建议前后添加自定义元素。对于添加弹出窗口、工具提示或图标到建议非常有用。

自定义样式和元素是使用 [Prosemirror Decorations API](https://prosemirror.net/docs/ref/#view.Decorations) 实现的。

要了解如何在选择建议时显示弹出窗口，请遵循 [此指南](/content-ai/capabilities/suggestion/features/display-suggestions#show-a-popover-when-you-select-a-suggestion)。

```ts
AiSuggestion.configure({
  getCustomSuggestionDecoration({ suggestion, isSelected, getDefaultDecorations }) {
    // 您可以将 AI 建议扩展的默认装饰与自定义装饰结合使用
    const decorations = getDefaultDecorations()

    // 在建议文本前添加一个自定义元素
    Decoration.widget(suggestion.deleteRange.from, () => {
      const element = document.createElement('span')
      element.textContent = '⚠️'
      return element
    })
    return decorations
  },
})
```

## 自定义加载建议的时机

默认情况下，AI 建议扩展将在编辑器准备好时自动加载建议。您可以使用 `loadOnStart` 选项禁用此行为。

```ts
AiSuggestion.configure({
  loadOnStart: false,
})
```

默认情况下，当编辑器的内容发生变化时，AI 建议扩展将重新加载建议。您可以使用 `reloadOnUpdate` 选项禁用此行为。

```ts
AiSuggestion.configure({
  reloadOnUpdate: false,
})
```

您可以在 [此指南](/content-ai/capabilities/suggestion/features/configure-when-to-load-suggestions) 中学习如何配置加载建议的时机。

## 自定义去抖超时

默认情况下，AI 建议扩展将在用户停止输入后等待 800 毫秒再重新加载建议。这防止了 API 被频繁调用。您可以使用 `debounceTimeout` 选项配置此超时。

```ts
AiSuggestion.configure({
  debounceTimeout: 1000,
})
```

## 处理加载建议时的错误

您可以提供一个回调函数来处理加载建议时的错误。这允许您记录错误、向用户显示错误信息或在发生错误时采取其他措施。

关于如何在 UI 中处理加载和错误状态的完整指南可以在这里找到：

```ts
AiSuggestion.configure({
  onLoadSuggestionsError(error) {
    console.error('加载建议时发生错误', error)
  },
})
```

## Tiptap 内容 AI 云选项

如果您没有 [提供自己的后端](/content-ai/capabilities/suggestion/custom-llms)，AI 建议扩展将使用 Tiptap 内容 AI 云生成建议。

您可以使用 `model` 选项配置用于生成建议的 OpenAI 模型。默认模型为 `gpt-4o-mini`。我们推荐它用于大部分用例，因为它在速度、成本和准确性之间提供了良好的平衡。

```ts
AiSuggestion.configure({
  // 您的 Tiptap 内容 AI 应用 ID
  appId: 'APP_ID_HERE',
  // 这需要是您生成的 JWT，且绝对不能是 OpenAI API 密钥！
  token: 'YOUR_TOKEN',
  // 用于生成建议的模型。默认为 "gpt-4o-mini"
  model: 'gpt-4o',
})
```

我们目前支持以下 OpenAI 模型：

- `gpt-4.1`
- `gpt-4.1-2025-04-14`
- `gpt-4.1-mini`
- `gpt-4.1-mini-2025-04-14`
- `gpt-4.1-nano`
- `gpt-4.1-nano-2025-04-14`
- `chatgpt-4o-latest`
- `gpt-4o-mini`
- `gpt-4o-mini-2024-07-18`
- `gpt-4o`
- `gpt-4o-2024-11-20`
- `gpt-4o-2024-08-06`
- `gpt-4o-2024-05-13`
- `gpt-4-turbo`
- `gpt-4-turbo-2024-04-09`
- `gpt-4-turbo-preview`
- `gpt-4`
- `gpt-4-0125-preview`
- `gpt-4-1106-preview`
- `gpt-4-0613`
- `gpt-4-0314`
- `gpt-4-32k`
- `gpt-4-32k-0613`
- `gpt-3.5-turbo-0125`
- `gpt-3.5-turbo`
- `gpt-3.5-turbo-1106`
- `gpt-3.5-turbo-16k`

## 集成您自己的后端和 LLMs

如果您想使用自己的后端和 LLMs 来生成建议，可以提供自定义 `resolver` 函数。此函数应根据编辑器的内容和规则返回一组建议。

您可以在 [此指南](/content-ai/capabilities/suggestion/custom-llms) 中找到关于如何集成您自己的后端和 LLMs 的更全面指南。

```ts
AiSuggestion.configure({
  resolver: async ({ content, rules }) => {
    // 您自定义生成建议的逻辑
    return suggestions
  },
})
```

## 向 LLM 提供额外上下文

如果您想向 LLM 提供额外信息，可以使用 `context` 选项。此选项允许您传递可以用来提高建议质量的附加数据。

`context` 选项是一个将作为提示的一部分添加到 LLM 的字符串。它将应用于所有规则。

```ts
AiSuggestion.configure({
  context: '语气应正式且专业。',
})
```

您可以在 [此指南](/content-ai/capabilities/suggestion/features/provide-llm-context) 中了解更多关于提供上下文的信息。

## 配置缓存

AI 建议扩展缓存建议以最小化 API 调用。它将编辑器内容分块并存储每个块生成的建议。在重新加载建议时，仅重新获取已修改的块。此行为默认启用，但您可以自定义它。

通过将 `enableCache` 设置为 `false`，您可以禁用缓存。这将使 AI 建议扩展在编辑器内容更改时对所有块调用 API。

```ts
AiSuggestion.configure({
  // 禁用缓存
  enableCache: false,
})
```

您可以使用 `chunkSize` 选项配置块大小。此选项控制每个块中包含多少个顶级节点。默认值为 `2`，这意味着对于一个包含 10 个段落的文档，AI 建议将创建 5 个包含 2 个段落的块。

```ts
AiSuggestion.configure({
  // 每个块将包含 3 个顶级 HTML 节点
  chunkSize: 3,
})
```

通过重写 `chunkHtml` 函数，您可以自定义块的生成。此函数接收编辑器内容并应返回一个 HTML 字符串数组，每个字符串表示一个块。这使您可以精细控制内容如何拆分成块。

```ts
AiSuggestion.configure({
  chunkHtml: customChunkHtmlFunction,
})
```