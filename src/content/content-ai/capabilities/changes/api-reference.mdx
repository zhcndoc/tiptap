---
title: AI 变更扩展 API 参考
meta:
  title: API 参考 | Tiptap AI 变更
  description: Tiptap AI 变更扩展的 API 参考。
  category: 内容 AI
---

## 扩展选项

```ts
/**
 * AI 变更扩展的配置选项
 */
export interface AiChangesOptions {
  /**
   * 为 AI 变更创建装饰
   *
   * @default getDefaultDecorations 参数
   *
   * @param options 当前变更信息、变更列表、当前是否被选中、获取默认装饰的函数、编辑器实例、AI 更改前的文档，以及 AI 更改后的文档。
   * @returns 一个包含 ProseMirror 装饰的列表，将会应用到文档中
   */
  getCustomDecorations: (options: GetCustomDecorationsOptions) => Decoration[];
}

/**
 * `getCustomDecorations` 函数的选项
 */
export interface GetCustomDecorationsOptions {
  /**
   * 当前正在处理的变更
   */
  change: AiChange;
  /**
   * AI 产生的变更列表
   */
  changes: AiChange[];
  /**
   * 当前变更是否被选中
   */
  isSelected: boolean;
  /**
   * 获取默认装饰的方法（如果未提供 `getCustomDecorations` 函数，则扩展会应用这些默认装饰到文档）
   *
   * @returns 要应用到文档的默认装饰列表
   */
  getDefaultDecorations: () => Decoration[];
  /**
   * Tiptap 编辑器实例
   */
  editor: Editor;
  /**
   * AI 更改前的上一个文档
   */
  previousDoc: Node | null;
  /**
   * AI 更改后的当前文档
   */
  currentDoc: Node;
}
```

## 扩展命令

```ts
/**
 * AI 变更扩展的命令
 */
declare module '@tiptap/core' {
  interface Commands<ReturnType> {
    previewAiAgentChanges: {
      /**
       * 开始追踪文档中的 AI 变更，并显示当前文档与初始文档之间的差异。
       *
       * @param doc 用于比较的初始文档。如果未提供，则使用当前文档。
       */
      startTrackingAiChanges: (doc?: Node) => ReturnType

      /**
       * 停止追踪文档中的 AI 变更。将初始文档设置为 `null`，并停止显示当前文档与初始文档之间的差异。
       */
      stopTrackingAiChanges: () => ReturnType

      /**
       * 接受文档中的所有 AI 变更。将初始文档设置为当前文档。
       */
      acceptAllAiChanges: () => ReturnType

      /**
       * 拒绝文档中的所有 AI 变更，将文档还原到初始状态。
       */
      rejectAllAiChanges: () => ReturnType

      /**
       * 接受文档中的某个特定 AI 变更，将初始文档相应部分修改为当前文档内容。
       *
       * @param id 要接受的变更的 ID
       */
      acceptAiChange: (id: string) => ReturnType

      /**
       * 拒绝文档中的某个特定 AI 变更，将当前文档在该变更范围内还原为初始文档内容。
       *
       * @param id 要拒绝的变更的 ID
       * @returns
       */
      rejectAiChange: (id: string) => ReturnType

      /**
       * 显示或隐藏文档中的 AI 变更。
       *
       * @param show 是否显示 AI 变更
       */
      setShowAiChanges: (show: boolean) => ReturnType
      /**
       * 选中某个AI变更，并将光标设置在变更范围的起始位置。
       *
       * @param id 要选择的变更的 ID
       */
      selectAiChange: (id: string) => ReturnType
    }
  }
}
```

## 扩展存储

```ts
/**
 * AI 变更扩展的内部存储属性
 */
export interface AiChangesStorage {
  /** 插件的唯一标识，用于 ProseMirror 插件 */
  pluginKey: PluginKey<AiChangesProsemirrorPluginState>
  /**
   * 返回由 AI 产生的变更列表
   *
   * @returns 文档中的变更列表
   */
  getChanges: () => AiChange[]
  /**
   * 获取当前被选中的变更（光标位于该变更范围内）
   *
   * @returns 当前被选中的变更，或 null（未选中任何变更）
   */
  getSelectedChange: () => AiChange | null
  /**
   * 返回 AI 更改前的上一个文档。如果扩展未在追踪变更，则返回 null。
   *
   * @returns AI 更改前的文档，或 null（无追踪变更）
   */
  getPreviousDoc: () => Node | null
  /**
   * 判断扩展是否在追踪 AI 产生的变更。
   *
   * @returns 如果在追踪，返回 true；否则返回 false
   */
  getIsTrackingAiChanges: () => boolean
  /**
   * 判断扩展是否在显示 AI 产生的变更。
   *
   * @returns 如果在显示，返回 true；否则返回 false
   */
  getIsShowingAiChanges: () => boolean
}
```

## 扩展类型

### 变更

```ts
import { Range } from '@tiptap/core'

/**
 * 由 AI 代理产生的变更。变更对象通过比较变更前后两个文档（AI 代理操作前后的内容）计算得到。
 * 这些变更对象会存储在 AI 变更扩展的存储中，并用于在编辑器中渲染变更。
 */
export interface AiChange {
  /**
   * 变更的唯一标识符。
   */
  id: string
  /**
   * 在旧文档中被删除的内容范围。
   */
  oldRange: Range
  /**
   * 在新文档中添加的内容范围。
   * 也即 AI 代理插入的内容范围。
   */
  newRange: Range
}
```