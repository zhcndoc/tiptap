---
title: 工作流程
meta:
  title: 工作流程 | Tiptap 内容 AI
  description: AI 工具包内置工作流程的 API 参考。
  category: 内容 AI
---

工作流程是 AI 模型执行单一且明确定义任务的场景。AI 工具包包含以下内置工作流程：

- [插入内容](/content-ai/capabilities/ai-toolkit/workflows/insert-content)。
- [校对器](/content-ai/capabilities/ai-toolkit/workflows/proofreader)。
- [Tiptap 编辑](/content-ai/capabilities/ai-toolkit/workflows/tiptap-edit)。
- [评论](/content-ai/capabilities/ai-toolkit/workflows/comments)。
- [模板](/content-ai/capabilities/ai-toolkit/workflows/template)。

以下是支持这些内置工作流程的方法的 API 参考。

## `createProofreaderWorkflow`（服务器端工具）

创建一个预设的校对工作流程配置。返回一个系统提示和用于验证 AI 输出的模式。

该工作流程期望用户的输入是一个 JSON 对象，包含：

- `content`: 需要校对的文档内容（详情见客户端设置章节如何获取）
- `task`：描述待完成任务的字符串
- `context`: （可选）与任务相关的额外上下文或背景信息

### 返回值

- `systemPrompt`（`string`）：可直接使用的系统提示，指导 AI 模型如何生成校对操作
- `zodOutputSchema`（`ZodObject`）：用于验证 AI 输出的 Zod 模式
- `jsonOutputSchema`（`object`）：用于验证 AI 输出的 JSON 模式

`systemPrompt` 字段包含一个带有合理默认值的示例提示，建议您阅读并根据需求修改。

### 示例

```ts
import { createProofreaderWorkflow } from '@tiptap-pro/ai-toolkit-tool-definitions'
import { Output, streamText } from 'ai'
import { openai } from '@ai-sdk/openai'

// 从 API 端点请求中获取文档内容
const { content } = apiEndpointRequest

// 创建并配置工作流程
const workflow = createProofreaderWorkflow()

const result = streamText({
  model: openai('gpt-5-mini'),
  // 系统提示
  system: workflow.systemPrompt,
  // 用户消息，包含内容和任务
  prompt: JSON.stringify({
    content,
    task: '纠正所有语法和拼写错误',
    context: '这是一个正式的商务文件',
  }),
  output: Output.object({ schema: workflow.zodOutputSchema }),
  // 若使用 gpt-5-mini，设置推理努力度为最小以提升响应速度
  providerOptions: {
    openai: {
      reasoningEffort: 'minimal',
    },
  },
})
```

## `createInsertContentWorkflow`（服务器端工具）

创建一个预设的插入或替换内容工作流程配置。返回用于 AI 模型的系统提示。

该工作流程期望用户的输入为包含以下属性的 JSON 对象：

- `task`：待完成的任务
- `replace`：待替换的 HTML 内容（可选）
- `before`：插入在之前的 HTML 内容（可选）
- `after`：插入在之后的 HTML 内容（可选）

### 返回值

- `systemPrompt`（`string`）：可直接使用的系统提示，指导 AI 模型如何生成 HTML 内容

`systemPrompt` 字段包含一个带有合理默认值的示例提示，建议您阅读并根据需求修改。

### 示例

```ts
import { createInsertContentWorkflow } from '@tiptap-pro/ai-toolkit-tool-definitions'
import { streamText } from 'ai'
import { openai } from '@ai-sdk/openai'

// 从 API 端点请求中获取任务和选区信息
const { task, replace } = apiEndpointRequest

// 创建并配置工作流程
const workflow = createInsertContentWorkflow()

const result = streamText({
  model: openai('gpt-5-mini'),
  // 系统提示
  system: workflow.systemPrompt,
  // 用户消息，包含任务和内容对象
  prompt: JSON.stringify({
    task,
    replace,
  }),
  // 如使用 gpt-5-mini，设置推理努力度为最小提升响应速度
  providerOptions: {
    openai: {
      reasoningEffort: 'minimal',
    },
  },
})

return result.toTextStreamResponse()
```

## `proofreaderWorkflow`

将一组校对操作应用于文档。

### 参数

- `options` (`ProofreaderWorkflowOptions`): 配置选项
  - `operations` (`PartialProofreaderOperation[]`): 校对操作数组。
  - `workflowId` (`unknown`): 此工作流运行的唯一 ID
  - `reviewOptions?` (`ReviewOptions`): 控制预览/审核行为
    - `mode?` (`'disabled' | 'review' | 'preview'`): 是否在应用更改之前或之后进行审核。`'disabled'` 表示不进行审核，`'review'` 表示在应用后进行审核，`'preview'` 表示在应用前进行预览。默认值：`'disabled'`
    - `diffMode?` (`'detailed' | 'full'`): 当启用审核模式时，如何显示原始内容和修改内容之间的差异。`'detailed'` 比较更改前后的文档，并以丰富的差异形式显示删除的内容和添加的内容。`'full'` 以整体块的形式显示删除的内容和添加的内容，作为包含删除和添加内容的单个更改。默认值：`'detailed'`
    - `displayOptions?` (`DisplayOptions<{ suggestion: Suggestion }>`): 自定义建议的显示方式
      - `showAsDiff?` (`boolean`): 是否将建议显示为差异，其中插入的内容和原始内容并排显示。默认值：`true`
      - `diffPosition?` (`'before' | 'after'`): 差异相对于建议的位置。默认值：`'before'`
      - `attributes?` (`Record<string, any>`): 要添加到建议的额外 HTML 属性
      - `renderDecorations?` (`RenderDecorations<{ suggestion: Suggestion }>`): 用于将建议呈现为 ProseMirror 装饰的函数
    - `metadata?` (`Record<string, any>`): 建议的额外元数据，可用于存储有关它们的附加信息（例如其来源或类别）。扩展内部不使用此信息，但可能有助于开发人员自定义 UI 中建议的显示方式。
    - `diffUtilityConfig?` (`DiffUtilityConfig`): 用于比较文档的差异工具的选项
      - `simplifyChanges?` (`boolean`): 是否简化更改。如果为 `true`，更改将被简化，例如，将同一单词中的两个更改合并为一个更改。仅在模式为 'detailed'、'smartInline' 或 'smartInlineV2' 时适用。默认值：`true`
      - `ignoreAttributes?` (`string[]`): 要忽略的属性。默认值：`['id', 'data-thread-id']`
      - `ignoreMarks?` (`string[]`): 要忽略的标记。默认值：`['inlineThread']`
      - `changeMergeDistance?` (`number | null`): 更改合并的最大距离（以文档位置为单位）。如果两个相邻更改在 rangeA 或 rangeB 中的距离小于或等于此值，它们将合并为一个更改。设置为 `null` 或 `undefined` 以禁用合并。仅在模式为 'detailed' 时适用。默认值：`null`
      - `mode?` (`'detailed' | 'block' | 'smartInline' | 'smartInlineV2'`): 用于比较的差异模式。`'detailed'` 执行字符级别的差异，识别文本中的精确更改（默认）。`'block'` 执行块级差异，将每个顶层节点视为一个单元。块模式在只需知道哪些段落、标题或其他块级元素发生变化时非常有用，而不需要字符级的细节。在块模式下，`simplifyChanges` 和 `changeMergeDistance` 选项将被忽略。`'smartInline'` 结合了两者：首先识别更改的块，然后在这些块内执行内联差异。适用于只改变部分内容的文档，同时仍提供字符级精度。`'smartInlineV2'` 改进了 `smartInline`，能正确显示块元素（如表格）中的更改。默认值：`'detailed'`
  - `range?` (`Range`): 应用校对操作的区间
    - `from` (`number`): 起始位置
    - `to` (`number`): 结束位置
  - `selectableNodeTypes?` (`string[]`): 始终应具有哈希的节点类型名称数组，即使它们不是顶层节点。默认情况下，所有块节点类型都可以有哈希。若设置为 `[]`，则仅顶层节点拥有哈希。

### 返回值（`ProofreaderWorkflowResult`）

- `doc`（`Node`）：应用操作后的修改文档
- `operations`（`ProofreaderOperationResult[]`）：与输入操作顺序对应的操作结果数组。每项内容包括：
  - `delete`（`string`）：被删除（或待删除）的文本
  - `insert`（`string`）：被插入（或待插入）的文本
  - `success`（`boolean`）：操作是否成功
  - `error?`（`string`）：失败时的错误信息

### 示例

```ts
const toolkit = getAiToolkit(editor)

// 获取适合 AI 快速且高效编辑的文档格式
const { content } = toolkit.tiptapRead()

const operations = await callApiEndpoint({ content })

// 应用校对更正
const result = toolkit.proofreaderWorkflow({
  operations,
  workflowId: 'proofread-123',
  reviewOptions: {
    mode: 'preview',
  },
})
```

## `createTiptapEditWorkflow`（服务器端工具）

创建一个预设的文档编辑工作流程配置。返回系统提示和用于验证 AI 输出的模式。

该工作流程期望用户的输入为 JSON 对象，包含：

- `content`: 待编辑文档的内容（来自 `tiptapRead`）
- `task`：描述待完成编辑任务的字符串
- `context`: （可选）与任务相关的额外上下文或背景信息

### 返回值

- `systemPrompt`（`string`）：可直接使用的系统提示，指导 AI 模型如何生成编辑操作
- `zodOutputSchema`（`ZodObject`）：用于验证 AI 输出的 Zod 模式
- `jsonOutputSchema`（`object`）：用于验证 AI 输出的 JSON 模式

### 示例

```ts
import { createTiptapEditWorkflow } from '@tiptap-pro/ai-toolkit-tool-definitions'
import { Output, streamText } from 'ai'
import { openai } from '@ai-sdk/openai'

// 从 API 端点请求中获取文档内容和任务
const { content, task } = apiEndpointRequest

// 创建并配置工作流程
const workflow = createTiptapEditWorkflow()

const result = streamText({
  model: openai('gpt-5-mini'),
  system: workflow.systemPrompt,
  prompt: JSON.stringify({ content, task, context }),
  output: Output.object({ schema: workflow.zodOutputSchema }),
})
```

## `tiptapEditWorkflow`

将一组编辑操作应用于文档。

### 参数

- `options` (`TiptapEditWorkflowOptions`): 配置选项
  - `operations` (`PartialTiptapEditOperation[]`): 编辑操作数组。每个操作为三元组 `[type, target, content]`：
    - `type`: `'replace'` | `'insertBefore'` | `'insertAfter'`
    - `target`: 节点的 6 位哈希（来自 `tiptapRead`）或 `'doc'` 表示整个文档
    - `content`: 要插入的 HTML 字符串内容
  - `workflowId` (`unknown`): 此工作流运行的唯一 ID
  - `selectableNodeTypes?` (`string[]`): 始终应具有哈希的节点类型名称数组，即使它们不是顶层节点。默认情况下，所有块节点类型都可以有哈希。若设置为 `[]`，则仅顶层节点拥有哈希。
  - `reviewOptions?` (`ReviewOptions`): 控制预览/审核行为（同 `proofreaderWorkflow` 的选项）
  - `tiptapEditHooks?` (`TiptapEditHooks`): 拦截和修改操作的钩子。详见 [Tiptap 编辑钩子指南](/content-ai/capabilities/ai-toolkit/advanced-guides/tiptap-edit-hooks)。
    - `beforeOperation?` (`(context: BeforeOperationContext) => BeforeOperationResult`): 在每个操作应用之前调用。返回 `{ action: 'accept' }` 以应用操作（可选择提供 `fragment` 或 `operationType` 覆盖），或 `{ action: 'reject', error }` 以跳过该操作。

### 返回值（`TiptapEditWorkflowResult`）

- `doc`（`Node`）：应用操作后的修改文档
- `successful`（`string[]`）：成功处理的目标哈希数组
- `failed`（`{ target: string; error?: string }[]`）：失败操作数组，含错误信息

### 示例

```ts
const toolkit = getAiToolkit(editor)

// 获取带哈希的文档内容
const { content } = toolkit.tiptapRead()

const operations = await callApiEndpoint({ content, task: '使文本更正式' })

// 应用编辑操作
const result = toolkit.tiptapEditWorkflow({
  operations,
  workflowId: 'edit-123',
  reviewOptions: {
    mode: 'preview',
  },
})
```

## `createEditThreadsWorkflow`（服务器端工具）

创建一个预设的评论和线程管理工作流程配置。返回系统提示和用于验证 AI 输出的模式。

该工作流程期望用户的输入为 JSON 对象，包含：

- `content`: 文档内容（来自 `tiptapRead`）
- `threads`：文档中的现有线程（来自 `getThreads`）
- `task`：描述评论管理任务的字符串

### 返回值

- `systemPrompt`（`string`）：可直接使用的系统提示，指导 AI 模型如何管理评论
- `zodOutputSchema`（`ZodObject`）：用于验证 AI 输出的 Zod 模式
- `jsonOutputSchema`（`object`）：用于验证 AI 输出的 JSON 模式

### 示例

```ts
import { createEditThreadsWorkflow } from '@tiptap-pro/ai-toolkit-tool-definitions'
import { Output, streamText } from 'ai'
import { openai } from '@ai-sdk/openai'

// 从 API 端点请求中获取内容、线程和任务
const { content, threads, task } = apiEndpointRequest

// 创建并配置工作流程
const workflow = createEditThreadsWorkflow()

const result = streamText({
  model: openai('gpt-5-mini'),
  system: workflow.systemPrompt,
  prompt: JSON.stringify({ content, threads, task }),
  output: Output.object({ schema: workflow.zodOutputSchema }),
})
```

## `getThreads`

获取文档中所有线程及其评论和位置信息。

### 返回值（`GetThreadsResult`）

- `threadCount`（`number`）：文档中线程数量
- `threads`（`ThreadInfo[]`）：线程信息数组，每项包含：
  - `id`（`string`）：线程唯一标识
  - `comments`（`{ id: string; content: string }[]`）：线程中的评论数组
  - `nodeRange?`（`string`）：线程所在节点范围
  - `documentContent?`（`string`）：线程应用的 HTML 内容

### 示例

```ts
const toolkit = getAiToolkit(editor)

// 获取文档中所有线程
const result = toolkit.getThreads()

console.log(`共找到 ${result.threadCount} 个线程`)

result.threads.forEach((thread) => {
  console.log(`线程 ${thread.id}：${thread.comments.length} 条评论`)
})
```

## `editThreadsWorkflow`

将评论和线程操作应用于文档。

### 参数

- `options` (`EditThreadsWorkflowOptions`): 配置选项
  - `operations` (`string[][]`): 评论操作数组，元素为操作元组。
  - `selectableNodeTypes?` (`string[]`): 始终应具有哈希的节点类型名称数组，即使它们不是顶层节点。默认情况下，所有块节点类型都可以有哈希。若设置为 `[]`，则仅顶层节点拥有哈希。
  - `commentsOptions?` (`CommentsOptions`): 评论操作选项
    - `threadData?` (`Record<string, any>`): 创建的线程的额外元数据
    - `commentData?` (`Record<string, any>`): 创建的评论的额外元数据

### 返回值（`EditThreadsWorkflowResult`）

- `operations`（`EditThreadsOperationResult[]`）：操作结果数组
- `success`（`boolean`）：所有操作是否均成功

### 示例

```ts
const toolkit = getAiToolkit(editor)

// 获取文档内容和线程
const { content } = toolkit.tiptapRead()
const { threads } = toolkit.getThreads()

const operations = await callApiEndpoint({ content, threads, task: '添加复审评论' })

// 应用评论操作
const result = toolkit.editThreadsWorkflow({
  operations,
})

if (result.success) {
  console.log('所有评论操作均成功完成')
}
```

## `createTemplateWorkflow`（服务器端工具）

创建一个预设的模板填充工作流程配置。接受一个 HTML 模板字符串（由客户端的 `createHtmlTemplate` 方法生成），自动提取所有模板键，并返回系统提示及验证 AI 输出的模式。

该工作流程期望用户的输入为 JSON 对象，包含：

- `task`：描述为模板生成内容的字符串
- `context`: （可选）与任务相关的额外上下文或背景信息

### 参数

- `options` (`CreateTemplateWorkflowOptions`): 配置选项
  - `htmlTemplate` (`string`): 由客户端 `createHtmlTemplate` 方法生成的 HTML 模板字符串

### 返回值

- `systemPrompt`（`string`）：可直接使用的系统提示，指导 AI 模型如何填充模板
- `zodOutputSchema`（`ZodObject`）：用于验证 AI 输出的 Zod 模式
- `jsonOutputSchema`（`object`）：用于验证 AI 输出的 JSON 模式

### 示例

```ts
import { createTemplateWorkflow } from '@tiptap-pro/ai-toolkit-tool-definitions'
import { Output, streamText } from 'ai'
import { openai } from '@ai-sdk/openai'

const { htmlTemplate, task } = apiEndpointRequest

const workflow = createTemplateWorkflow({ htmlTemplate })

const result = streamText({
  model: openai('gpt-5-mini'),
  system: workflow.systemPrompt,
  prompt: JSON.stringify({ task, context }),
  output: Output.object({ schema: workflow.zodOutputSchema }),
})

return result.toTextStreamResponse()
```

## `templateWorkflow`

用 AI 生成的值填充 Tiptap JSON 模板，并将结果插入编辑器。模板使用特殊属性（`_templateSlot`、`_templateIf`、`_templateAttributes`）标记动态部分。

### 参数

- `options` (`TemplateWorkflowOptions`): 配置选项
  - `template` (`Record<string, any>`): Tiptap JSON 格式的模板（doc 节点或片段数组）
  - `values` (`TemplateValues`): AI 生成且填充模板的值。键名对应模板属性中的值。
  - `position?` (`Range | number`): 插入填充模板的位置。默认：整个文档区间。
  - `hasFinished?` (`boolean`): 是否已完成流式传输。省略时方法以非流式模式运行。默认：`true`
  - `workflowId?` (`unknown`): 此工作流运行的唯一 ID。提供时启用流式模式，方法将在多次调用中跟踪插入区间并逐步替换内容。
  - `reviewOptions?` (`ReviewOptions`): 控制预览/审核行为

### 示例

```ts
import { experimental_useObject as useObject } from '@ai-sdk/react'
import { getAiToolkit } from '@tiptap-pro/ai-toolkit'
import { z } from 'zod'

const templateSchema = z.object({}).passthrough()

const { submit, isLoading, object } = useObject({
  api: '/api/template-workflow',
  schema: templateSchema,
})

// 在 useEffect 中流式传输部分结果
useEffect(() => {
  if (!editor || !object) return

  const toolkit = getAiToolkit(editor)
  toolkit.templateWorkflow({
    template: templateJson,
    values: object as Record<string, unknown>,
    position: 'document',
    hasFinished: !isLoading,
    workflowId,
  })
}, [object, workflowId, editor, isLoading])
```

## `createHtmlTemplate`

将 Tiptap JSON 模板转换为带有模板属性的 HTML 字符串。结果 HTML 可以发送到服务器，`createTemplateWorkflow` 将解析模板键。

由于这是 AI 工具包方法，自动拥有编辑器 schema，无需额外传入，直接传模板即可。

### 参数

- `template` (`Record<string, unknown>`): Tiptap JSON 格式的模板（doc 节点或片段数组）

### 返回值

- 带有小写模板属性（`_templateslot`、`_templateif`、`_templateattributes`）的 HTML `string`

### 示例

```ts
const toolkit = getAiToolkit(editor)
const htmlTemplate = toolkit.createHtmlTemplate(templateJson)
```
