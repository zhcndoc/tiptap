---
title: AI 工具包更新日志
meta:
  title: AI 工具包更新日志 | Tiptap AI 工具包
  description: '@tiptap-pro/ai-toolkit 包的更新日志'
  category: 内容 AI
---

# @tiptap-pro/ai-toolkit

## 3.0.0-alpha.87

### 小幅更新

- 新增 `invertSuggestions` 方法。该方法执行模拟运行，将所有当前建议应用于文档副本，并返回结果文档及可撤销这些更改的反向建议。反向建议保留原建议的元数据。预览模式的建议在反向结果中转为审核模式，反之亦然。

## 3.0.0-alpha.86

### 小幅更新

- 为 `diffUtility` 和 `ExternalDiffUtilityOptions` 添加 `expandBlockChanges` 选项。当匹配节点的类型在指定列表中，且其所有内联内容均已更改时，个别内联改动会被替换为覆盖整个节点的单一块级改动。默认为 `['listItem']`。仅在模式为 'smart' 时生效。

### 修复更新

- 修复当差异改动跨越无法作为直接 `doc` 内容的节点（例如，没有包裹 `bulletList` 的 `listItem` 节点）时，替换装饰渲染导致崩溃的问题。渲染时会先将内容包裹在所需的父节点中，再应用子改动标记。

## 3.0.0-alpha.85

### 小幅更新

- 为 `templateWorkflow` 和 `fillTemplate` 添加 `preserveSlotAttr` 选项。启用后，填充后节点会保留 `_templateSlot` 属性，以便识别 AI 填充内容及重新填充模板字段。
- 为 `fillTemplate` 增加相邻槽合并功能。多个连续的具有相同 `_templateSlot` 属性值的节点将被视为单一槽，一起替换为一个 HTML 输出。
- 为 `createTemplateValuesSchema` 添加 `requiredSlots`、`requiredConditions` 和 `requiredAttributes` 选项。省略时所有字段默认必填，传入空数组可使对应字段类型的所有字段变为可选。
- 新增 `TemplateField` Tiptap 扩展，注册 `_templateSlot`、`_templateIf` 和 `_templateAttributes` 为编辑器 schema 中所有节点类型的全局属性。该扩展提供命令（`setTemplateSlot`、`unsetTemplateSlot`、`setTemplateIf`、`unsetTemplateIf`、`setTemplateAttributes`、`unsetTemplateAttributes`）用于设置或取消当前选中节点的模板属性。

### 破坏性变更

- **破坏性变更**：`fillTemplate` 方法参数签名由位置参数 `(template, values, schema)` 改为命名选项对象 `(options: FillTemplateOptions)`。
- **破坏性变更**：`createTemplateValuesSchema` 方法参数签名由 `(template)` 改为 `(options: CreateTemplateValuesSchemaOptions)`。

## 3.0.0-alpha.84

### 修复更新

- 修复启用 `groupInlineChanges` 时，改动可能显示在文档完全不同位置的 Bug。

## 3.0.0-alpha.83

### 小幅更新

- 新增 `tiptapReadChunks` 方法。

## 3.0.0-alpha.82

### 重大更新

- **破坏性变更**：移除 `getText`、`getHtml`、`getJson`、`getTextSelection`、`getHtmlSelection` 和 `getJsonSelection` 方法。请改用 Tiptap 编辑器 API 或 `getTextRange`、`getHtmlRange`、`getJsonRange` 等新方法。
- **破坏性变更**：简化 `InsertPosition` 类型，由原有 8 个选项的联合类型改为 `Range | number`。位置参数现在接受数字偏移或 `Range` 对象，默认值为整个文档范围。
- **破坏性变更**：移除 `setHtmlSuggestions` 方法，建议改用校对工作流（Proofreader Workflow）。
- **破坏性变更**：移除 `smartInline` 和 `smartInlineV2` 差异模式，建议改用 `smart` 模式。
- **破坏性变更**：简化 `setSuggestions` 和 `addSuggestions` 方法，改为直接接受 `Suggestion[]`，不再支持 `SuggestionsFormat[]`。`compareDocuments` 格式亦不再支持。建议改用新的 `setSuggestionsFromDiff` 方法。
- **破坏性变更**：简化 `ReplacementOption` 类型，由判别联合类型（`SliceReplacementOption | TextReplacementOption`）改为包含 `content` 属性（类型为 `string | Slice`）的单一接口，移除 `type`、`addSlice` 和 `addText` 属性。

### 小幅更新

- 新增 `setSuggestionsFromDiff` 方法，支持比较两个文档并根据差异设置建议，用以替代旧版 `setSuggestions` 中的 `compareDocuments` 格式。

## 3.0.0-alpha.81

### 修复更新

- 修复自定义节点视图嵌套于容器节点（如引用块或列表）时无法正确渲染的问题。

## 3.0.0-alpha.80

### 修复更新

- 修复替换子更改标记跨节点边界时显示错误的问题。
- 修正 `simplifyChanges` 误将改动范围扩展至单词边界之外的错误。现改动相邻的非字母字符（如空格、标点符号）不会被包含在改动范围内。单词边界计算时同时检测原文和修改后的文档内容。

## 3.0.0-alpha.79

### 修复更新

- 改进编辑后文档节点哈希的稳定性。

## 3.0.0-alpha.78

### 修复更新

- 降低文档节点哈希计算时的碰撞概率。

## 3.0.0-alpha.77

### 修复更新

- 修复用户修改文档后，AI 无法定位用户修改内容下方内容，导致必须重新读取文档的问题。

## 3.0.0-alpha.76

### 修复更新

- 修复 `offsetChanges` 映射改动时未保留 `isInlineGroup` 属性，导致内联组信息丢失的问题。

## 3.0.0-alpha.75

### 重大更新

- **破坏性变更**：新增默认差异模式 `smart`，智能适配块级和内联内容。改动绝不跨越块边界，适用于结构化文档的编辑，生成清晰的差异结果。
- **破坏性变更**：将 `detailed` 差异模式重命名为 `inline`。
- **破坏性变更**：在 `ReviewOptions` 中，使用布尔类型 `useDiffUtility` 替代 `diffMode` 属性。`useDiffUtility: true` 替代以前的 `diffMode: 'detailed'`，`useDiffUtility: false` 替代 `diffMode: 'full'`。
- **破坏性变更**：默认 `changeMergeDistance` 设置为 `10`。
- **破坏性变更**：将 `displayOptions.showAsDiff` 重命名为 `displayOptions.showReplacement`。
- **破坏性变更**：移除 `displayOptions.diffPosition`。
- **破坏性变更**：将 `displayOptions.diffAttributes` 重命名为 `displayOptions.replacementAttributes`。
- **破坏性变更**：类型 `DiffUtilityConfig` 重命名为 `ExternalDiffUtilityOptions`。
- **破坏性变更**：所有方法与选项中的属性 `diffUtilityConfig` 重命名为 `diffUtilityOptions`。

### 弃用提示

- 弃用 `smartInline` 和 `smartInlineV2` 差异模式，推荐使用 `smart` 模式替代。

### 小幅更新

- 提升内联差异模式的性能。
- 修复差异工具在新增和删除内容均以空格结尾时的 Bug。
- 在 `diffUtility` 和 `diffUtilityOptions` 中增加 `groupInlineChanges`，用于控制内联改动何时合并为单一建议。
- 在 `displayOptions` 中新增 `showSubChanges`、`subChangeAttributes` 和 `replacementSubChangeAttributes`，支持自定义分组内联改动的展示。
- 在 `Suggestion` 类型中增加 `isInlineGroup` 字段，表示分组的内联改动。
- 校对工作流（`proofreaderWorkflow`）中默认不对内联改动分组，可通过 `reviewOptions.diffUtilityOptions.groupInlineChanges` 覆盖。

## 3.0.0-alpha.74

### 修复更新

- 修复在协作文档中，其他用户删除建议内容时未自动移除该建议的问题。

## 3.0.0-alpha.73

### 小幅更新

- 新增模板工作流：`templateWorkflow` 方法，支持使用 AI 生成内容以填充结构化的 Tiptap 模板。
- 新增 `createHtmlTemplate` 工具，可将 Tiptap JSON 模板转换为 HTML。

## 3.0.0-alpha.72

### 修复更新

- 修复 ES2025 迭代器辅助函数（如 `Map.entries().filter()`、`.map()` 等）在 Safari < 18.4、Firefox < 131 及其他不支持此特性的浏览器中导致 `TypeError` 的兼容性问题。

## 3.0.0-alpha.71

### 修复更新

- 修复建议范围内空段落未被正确视觉标记的问题。

## 3.0.0-alpha.70

### 小幅更新

- 为 `toolDefinitions()` 和 `tiptapEditTool()` 添加 `operationMeta` 选项。启用后，AI 每次编辑操作均包含 `meta` 字段，说明改动原因。

## 3.0.0-alpha.69

### 小幅更新

- 改进 `diffUtility` 中 `simplifyChanges` 的行为。
- 启用 `simplifyChanges` 时，单字符词内编辑将扩展至整个单词边界。
- 支持单字符的插入、删除和替换，使差异更可读。

## 3.0.0-alpha.68

### 修复更新

- 修正校对工作流流处理时报错的问题。

## 3.0.0-alpha.67

### 重大更新

- 改用 Tiptap 位置工具进行位置映射，要求 Tiptap 版本 ≥ 3.12.0。
- 全新流处理实现，允许 AI 流式期间其他用户编辑文档。相关操作包括：
  - `tiptapEdit` 工具
  - `proofreaderWorkflow`
  - `tiptapEditWorkflow`
  - `streamText`
  - `streamHtml`

### 小幅更新

- 新增 `AiCaret` 扩展，在 AI 流式操作时显示闪烁光标。
- 移除未使用依赖：`@tiptap/y-tiptap` 和 `@tiptap-pro/extension-comments`。

### 修复更新

- 修正文档更新时活动选择错误更新的问题。

## 3.0.0-alpha.66

### 修复更新

- 使 `smartInlineV2` 差异模式支持非内联且非块级元素，如表格单元格。

## 3.0.0-alpha.65

### 小幅更新

- 为 `diffUtility` 新增 `smartInlineV2` 差异模式。该模式改进了 `smartInline`，可正确展示块元素（比如表格）内的改动。

## 3.0.0-alpha.64

### 修复更新

- 避免使用旧版本不支持的 ProseMirror API，如 `toObject`。

## 3.0.0-alpha.63

### 小幅更新

- 为 `executeTool`、`streamTool` 和 `tiptapEditWorkflow` 增加 `tiptapEditHooks` 选项，允许在应用 Tiptap 编辑操作前拦截、修改或拒绝操作。`beforeOperation` 钩子接收操作上下文，返回 `BeforeOperationResult`，控制操作是否应用及其修改。

## 3.0.0-alpha.62

### 重大更新

- 更新 Tiptap 编辑工具的 `selectableNodeTypes` 参数，默认允许 AI 选择并替换文档中任意块节点。

### 修复更新

- 移除评论工具操作中的 `console.log` 调试语句。

## 3.0.0-alpha.61

### 修复更新

- 改进 `createThread` 操作，避免极少数情况下线程创建点错误。
- 重构代码，减小包体积。

## 3.0.0-alpha.60

### 修复更新

- 修正 `editThreads` 工具和评论工作流中线程有时创建于错误位置的 Bug。

## 3.0.0-alpha.59

### 小幅更新

- 为 `editThreads` 工具新增操作追踪流式支持，利用计数器在扩展存储追踪防止操作重复执行。工具调用 ID 变更时重置存储。
- 评论工作流新增流式支持。`editThreadsWorkflow` 增加 `isStreaming` 选项，设为 true 时执行所有操作但跳过最后一个；为 false 或未设置时执行全部操作（含最后一个）。操作计数防止重复执行，工作流 ID 变更时重置存储。

### 修复更新

- 流式 HTML 内容时不再显示尾随的 `<` 字符。

## 3.0.0-alpha.58

### 重大更新

- `executeTool` 和 `streamTool` 返回类型中的 `output` 属性现返回 JSON 对象，便于日志记录和工具输出解析。

### 小幅更新

- 为 `diffUtility` 新增 `smartInline` 差异模式。该模式结合块级和内联比较，先识别变更块，然后在块内执行字符级差异。适合文档局部修改，兼顾效率与细节。

## 3.0.0-alpha.57

### 重大更新

- **破坏性变更**：重构 Tiptap 编辑实现，提升效率和准确度。移除 `HashAttributeExtension`，增强 schema 处理和哈希生成逻辑。
- **破坏性变更**：`tiptapRead` 方法返回类型中的 `nodeRange` 重命名为 `contentRange`，增强清晰度。
- **破坏性变更**：工作流用户提示输入参数由 `nodes` 重命名为 `content`，影响 `tiptapEditWorkflow` 和 `editThreadsWorkflow`，请相应更新调用代码。

### 小幅更新

- 统一所有 Tiptap 方法中 `selectableNodeTypes` 的处理方式。
- 将 `addHashesToDocument` 工具移动至 `tiptap-read` 目录，优化结构。

### 修复更新

- 修正评论工具中评论插入位置错误。
- 简化 `addHashesToDocument` 和 `shortHash` 中的哈希生成流程。
- 优化 Tiptap 编辑函数中可选节点的处理逻辑。

## 3.0.0-alpha.56

### 修复更新

- `getThreads` 分页改用 `threadIndexRange` 的排他上界。

## 3.0.0-alpha.55

### 修复更新

- 按线程索引分页 `getThreads` 输出，遵守块大小限制。

## 3.0.0-alpha.54

### 修复更新

- 修正接受或拒绝全部建议时偶发的“范围越界”错误。
- 修复“比较文档”功能修改结果反馈错误。

## 3.0.0-alpha.53

### 小幅更新

- 新增 `tiptapEditWorkflow` 方法，执行支持 AI 精确高效编辑文档的工作流。
- 新增 `editThreadsWorkflow` 方法，执行支持 AI 管理文档评论与线程的工作流。
- 新增 `getThreads` 方法，获取文档中所有线程及其评论和位置。

## 3.0.0-alpha.52

### 修复更新

- 修正接受或拒绝建议后，其他建议位置未正确更新的问题。

## 3.0.0-alpha.51

### 重大更新

- **破坏性变更**：`editThreads` 工具采用全新更高效格式。新格式更快、更节省令牌，完全避免差异不匹配错误，显著提升准确性。

## 3.0.0-alpha.50

### 重大更新

- 简化建议 API，合并普通建议和“比较文档”更改为统一方法集。
- 移除“比较文档”功能中的 `acceptChange`、`rejectChange` 和 `rejectAllChanges`，改用 `acceptSuggestion`、`rejectSuggestion`、`acceptAllSuggestions` 和 `rejectAllSuggestions`，支持两种使用场景。
- 重命名 `applySuggestion` 为 `acceptSuggestion`，`applyAllSuggestions` 为 `acceptAllSuggestions`，增强一致性和清晰度。

### 小幅更新

- 为 `Suggestion` 接口新增 `reviewMode` 字段，用于指示建议处于“预览”还是“审核”模式。该字段由 `reviewOptions.mode` 自动设置。
- 新增 `rejectSuggestion` 和 `rejectAllSuggestions` 方法，用于拒绝建议，并返回 AI 针对拒绝更改的反馈。
- 修改 `acceptSuggestion` 和 `acceptAllSuggestions` 方法，返回包含用户接受或拒绝改动的 `aiFeedback`，包含删除和插入内容及状态，用于指导 AI 改进建议。

## 3.0.0-alpha.49

### 修复更新

- 用 `micro-memoize` 替换弃用依赖 `moize`。
- 移除未使用依赖 `debounce`。

## 3.0.0-alpha.48

### 重大更新

- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.19`
- 移除已废弃的 `insertFragment` 方法。
- 移除已废弃的 `getActiveNodeRange` 和 `setActiveNodeRange` 方法。

### 小幅更新

- 新增 AI 工具包的 `proofreaderWorkflow` 方法，支持 AI 校对文档的工作流。
- 新增 AI 工具包的 `tiptapRead` 方法，允许 AI 快速高效读取文档。

## 3.0.0-alpha.47

### 重大更新

- 新增并默认启用工具：`tiptapEdit`、`tiptapRead` 和 `tiptapReadSelection`。移除工具：`readNodeRange`、`readSelection`、`insertContent` 和 `applyPatch`。

## 3.0.0-alpha.46

### 小幅更新

- 新增实验性选用工具：`tiptapEdit`、`tiptapRead` 和 `tiptapReadSelection`，实现更快更高效编辑。

## 3.0.0-alpha.45

### 小幅更新

- 为 `diffUtility` 增加块级差异对比选项。`mode` 参数可设置为 `block`，按顶级节点比较文档，适用于仅需了解段落或标题变动且不需字符级细节的场景。

### 修复更新

- 修正 `diffUtility` 使用 `changeMergeDistance` 时，不同顶级节点相邻改动被误合并的问题，确保不同块改动正确分离。
- 修复 `editThreads` 工具 Bug：未读取文档即创建线程，导致线程未被创建。
- 确保 `startComparingDocuments` 中被比较文档与主文档使用相同的 schema。

## 3.0.0-alpha.44

### 小幅更新

- 新增 `setMarkdownSuggestions` 方法，支持通过比较 Markdown 内容与当前文档显示建议，需配置并安装 Tiptap Markdown 扩展。
- 新增 `getMarkdownRange` 方法，提取文档指定范围的 Markdown 内容，需配置并安装 Tiptap Markdown 扩展。

### 修复更新

- 修正 `setHtmlSuggestions` 和 `setMarkdownSuggestions` 替换文本时错误修改 HTML 标签的问题。例如替换 "a" 为 "an" 不会误改标签 `<a>` 为 `<an>`，且如果删除的文本不包含 `<` 或 `>`，替换操作仅影响文本内容，不修改标签。

## 3.0.0-alpha.43

### 修复更新

- 修复协作事务应用时装饰未正确更新的问题。

## 3.0.0-alpha.42

### 修复更新

- 修复协作事务应用时装饰未正确更新的问题。

## 3.0.0-alpha.41

### 重大更新

- 使用 `diffUtilityOptions` 替代 `changeMergeDistance` 参数，提供更丰富的文档比较工具自定义选项。

### 小幅更新

- 在 `setSuggestions` 的 `compareDocuments` 格式中新增 `diffUtilityOptions` 选项，允许配置文档比较工具。
- 在 `Suggestion` 类型的 `displayOptions` 中新增 `diffAttributes` 选项，用于自定义差异装饰属性。

## 3.0.0-alpha.40

### 修复更新

- 修正文档更新后 AI 读取错误文档内容的问题。

## 3.0.0-alpha.39

### 修复更新

- 修复新线程和评论未正确创建于文档位置的 Bug。

## 3.0.0-alpha.38

### 修复更新

- 修复 `applyPatch` 和 `insertContent` 工具流式处理时未正常工作的 Bug。

## 3.0.0-alpha.37

### 重大更新

- `applyPatch` 工具采用全新格式，显著提升速度和准确性。
- 改进所有内置工具的输入输出格式及工具定义。
- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.11`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.14`
  - `@tiptap-pro/ai-toolkit-anthropic@3.0.0-alpha.6`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.10`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.9`

## 3.0.0-alpha.36

### 重大更新

- 使 `insertContent` 工具的内容格式独立，将原 `"html"` 属性重命名为 `"content"`。
- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.10`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.13`
  - `@tiptap-pro/ai-toolkit-anthropic@3.0.0-alpha.5`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.9`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.8`

### 修复更新

- 修复 `insertContent` 工具中 `activeNodeRange` 位置无效问题。
- 修复 `insertContent` 导致 `activeNodeRange` 总被重置为 0 的问题。
- 修正 `setHtmlSuggestions` 边界错误及格式丢失。边界使用 `content.size` 替代 `nodeSize - 1`，应用建议时保留 HTML 格式（粗体、斜体、链接等）。

## 3.0.0-alpha.35

### 修复更新

- 修复 `streamText` 和 `streamHtml` 方法中不必要将 `ReadableStream` 转为 `AsyncIterable` 导致性能下降的问题。

## 3.0.0-alpha.34

### 小幅更新

- 为 `diffUtility`、`startComparingDocuments`、`setSuggestions`（`compareDocuments` 格式）、`setHtmlSuggestions` 及所有编辑方法的 `reviewOptions` 添加入参 `changeMergeDistance`，支持合并相近改动，限定最大改动间距进行合并。
- 为 `setHtmlSuggestions` 新增 `reviewOptions` 参数，支持用户定制建议显示选项（如 `diffPosition`、`showAsDiff`、自定义 `renderDecorations`）和自定义元数据，使用模式与其他编辑方法保持一致。
- 修正当 `setHtmlSuggestions` 无 `range` 参数时偏移计算错误，确保建议高亮准确，修复位置偏差为 -1 的 Bug。
- 修正 `setHtmlSuggestions` 默认 `diffPosition` 为 'after'，支持通过 `reviewOptions.displayOptions.diffPosition` 配置。

## 3.0.0-alpha.33

### 小幅更新

- 新增 `getSelectedSuggestion` 方法，用于获取当前选中的建议。

## 3.0.0-alpha.32

### 小幅更新

- 新增 `setActiveSelection` 方法，用于设置活动选择区域，覆盖工具如 `readSelection` 读取的当前编辑器选择。

## 3.0.0-alpha.31

### 小幅更新

- 在 `executeTool` 和 `streamTool` 中新增 `commentsOptions` 属性，允许传递自定义数据给线程和评论操作。`data` 用于线程数据（调用 `editor.commands.setThread`），`commentData` 用于评论数据（调用 `editor.commands.createComment` 和 `editor.commands.setThread`）。

## 3.0.0-alpha.30

### 修复更新

- 修复节点属性变更未被正确检测的问题。
- 实时比较文档时忽略 Unique ID 扩展的改动。
- 实时比较文档时忽略 Comments 扩展的改动。

## 3.0.0-alpha.29

### 小幅更新

- 新增 `setHtmlSuggestions` 方法，通过比较 HTML 内容与当前文档显示建议。

## 3.0.0-alpha.28

### 修复更新

- 修复错误导入导致打包失败的问题。

## 3.0.0-alpha.27

### 修复更新

- 修复 `createThread` 操作中线程偶尔创建于错误位置的 Bug。
- 优化 `createThread` 失败时 AI 接收的错误信息。

## 3.0.0-alpha.26

### 重大更新

- 新增基于 AI 的评论和线程管理工具 `editThreads` 和 `getThreads`。
- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.9`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.12`
  - `@tiptap-pro/ai-toolkit-anthropic@3.0.0-alpha.4`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.8`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.7`

## 3.0.0-alpha.25

### 修复更新

- 修复 `applyPatch` 流式处理导致最后操作未正确解析回退，防止文本流内容逐渐消失的问题。

## 3.0.0-alpha.24

### 重大更新

- 将 `applyDiff` 工具重命名为 `applyPatch`。
- 将 `applyHtmlDiff` 重命名为 `applyHtmlPatch`。
- 改进 `applyDiff`（现 `applyPatch`）格式及定义，使 AI 生成补丁操作列表更准确，避免无效跳转，显著降低令牌消耗。
- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.8`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.11`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.7`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.6`
  - `@tiptap-pro/ai-toolkit-anthropic@3.0.0-alpha.3`

## 3.0.0-alpha.23

### 小幅更新

- `insertContent` 工具新增 `activeNodeRange` 位置参数，允许 AI 在活动节点范围内插入内容。禁用 `applyDiff` 工具可提升编辑准确率。
- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.7`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.10`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.6`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.5`
  - `@tiptap-pro/ai-toolkit-anthropic@3.0.0-alpha.2`

## 3.0.0-alpha.22

### 小幅更新

- 在扩展配置中新增 `addHtmlSchemaAwareness` 方法，为自定义 Node 或 Mark 扩展提供 schema 识别数据。

## 3.0.0-alpha.21

### 修复更新

- 修正流式显示详细差异导致差异持续更新，现仅在流结束时显示详细差异。
- 修正流式内容开头插入多余段落的问题。

## 3.0.0-alpha.20

### 重大更新

- 将 `getSchemaAwareness` 改名为 `getHtmlSchemaAwareness`。
- 优化 schema 识别提示，令 AI 模型判断更准确。

## 3.0.0-alpha.19

### 小幅更新

- 实验性支持 AI 工具包与 Pages 扩展集成，新增 `readPage` 工具。

## 3.0.0-alpha.18

### 修复更新

- 修复 `streamHtml` 和 `streamText` 方法返回的 Promise 仅在流结束时 resolve 的问题。

## 3.0.0-alpha.17

### 重大更新

- 优化 `readSelection` 和 `insertContent` 工具定义，修复因用户修改选区导致 AI 插入位置错误的 Bug。

### 修复更新

- 修复 `streamHtml` 和 `streamText` 不支持 `ReadableStream` 参数的问题。

## 3.0.0-alpha.16

### 重大更新

- 审核选项中将 `detailedDiff` 重命名为 `diffMode`，用于控制显示原文与修改内容差异的方式。

## 3.0.0-alpha.15

### 重大更新

- 审核选项新增 `detailedDiff`，控制是否以详细差异形式展示更改。原 `showDiff` 选项改名为 `detailedDiff`，语义更清晰。
- 工具执行和流处理选项中新增 `detailedDiff`，默认值为 `true`，使更改默认以详细差异形式展示。

## 3.0.0-alpha.14

### 重大更新

- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.4`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.7`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.3`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.2`
- 移除 `executeTool` 中的 `currentChunk` 参数及返回字段。
- 新增 `getActiveNodeRange` 方法，获取活动节点范围，替代旧的 `currentChunk`，提升编辑准确性。
- 新增 `setActiveNodeRange` 方法，设置活动节点范围。
- 移除 `readFirstChunk`、`readNextChunk`、`readPreviousChunk` 工具。
- 新增 `readNodeRange` 工具，允许 AI 读取任意顶级节点范围，提高灵活性。

### 小幅更新

- 新增 `streamTool` 方法，支持向编辑器流式输入工具调用结果。

## 3.0.0-alpha.13

### 小幅更新

- 审核选项新增 `metadata` 字段，允许添加自定义元数据和属性。
- 新增 `streamText` 和 `streamHtml` 方法，支持向编辑器流式输入文本和 HTML。

### 修复更新

- 修复 `insertJson` 不支持 ProseMirror Fragment Tiptap JSON 的问题。
- 修复建议差异视图中显示多余元素（如多余段落）的错误。

## 3.0.0-alpha.12

### 修复更新

- 当编辑器未安装 AiToolkit 扩展时，调用 `getAiToolkit` 会显示警告。
- 修复 `getJsonChunks` 未正确返回 JSON 块格式的问题。
- 改进 `readFirstChunk` 的响应格式。

## 3.0.0-alpha.11

### 修复更新

- 修复 `diffUtility` 错误地将两个完全相同的空文档判定为不同的问题。

## 3.0.0-alpha.10

### 重大更新

- 新增 `replaceDocumentWhereChanged` 方法，支持高效替换整个文档，仅替换发生变更的部分，避免全部内容被标记为替换。
- 重写 `applyHtmlDiff` 和 `rejectAllChanges`，内部实现基于 `replaceDocumentWhereChanged`。

## 3.0.0-alpha.9

### 重大更新

- 新增 `rejectAllChanges` 方法，用于实时文档比较时一次性拒绝所有更改。

## 3.0.0-alpha.8

### 重大更新

- 新增 `acceptChange` 和 `rejectChange` 方法，用于实时文档比较时接受或拒绝单个更改。
- 移除 `applySuggestionToOtherDoc` 方法，因功能与 `acceptChange` 重复且命名易混淆。

## 3.0.0-alpha.7

### 重大更新

- 优化分块格式，包含分块的范围信息。
- 提升 `getHtmlRange`、`getJsonRange` 和 `getTextRange` 返回分块索引的准确度。

## 3.0.0-alpha.6

### 修复更新

- 修复错误导入问题。

## 3.0.0-alpha.5

### 小幅更新

- 新增 `applySuggestionToOtherDoc` 方法，用于实时比较文档时将建议应用于其他文档。
- 第一次调用 `startComparingDocuments` 时忽略防抖超时，提升响应速度。

## 3.0.0-alpha.4

### 重大更新

- 移除 `executeTool` 返回值中的 `needsReview`，替换为 `docChanged`。
- 当工具修改文档时，`docChanged` 设置为 `true`。

## 3.0.0-alpha.3

### 小幅更新

- 在 `executeTool` 返回类型中新增 `needsReview` 字段，表明调用是否需要用户审核。
- 新增一次应用所有建议的 `applyAllSuggestions` 方法。
- 优化工具调用失败时错误提示。

## 3.1.0-alpha.2

### 修复更新

- 修复 `executeTool` 参数中 `input` 类型，使其兼容 Vercel AI SDK。

## 3.1.0-alpha.1

### 重大更新

- AI 工具包初始 alpha 版发布。
