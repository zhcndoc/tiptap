---
title: AI 工具包更新日志
meta:
  title: AI 工具包更新日志 | Tiptap AI 工具包
  description: '@tiptap-pro/ai-toolkit 包的更新日志'
  category: 内容 AI
---

# @tiptap-pro/ai-toolkit

## 3.0.0-alpha.73

### 小幅更新

- 新增模板工作流：`templateWorkflow` 方法，用于用 AI 生成的内容填充结构化 Tiptap 模板。
- 新增 `createHtmlTemplate` 工具，用于将 Tiptap JSON 模板转换成 HTML。

## 3.0.0-alpha.72

### 修复更新

- 修复 ES2025 迭代器辅助函数（`Map.entries().filter()`、`.map()`）在 Safari < 18.4、Firefox < 131 及其他不支持迭代器辅助函数的浏览器中导致的 `TypeError` 兼容性问题。

## 3.0.0-alpha.71

### 修复更新

- 修复建议范围内的空段落没有被视觉标记的问题。

## 3.0.0-alpha.70

### 小幅更新

- 为 `toolDefinitions()` 和 `tiptapEditTool()` 新增 `operationMeta` 选项。设置后，AI 会在每个编辑操作中包含 `meta` 字段，说明变更原因。

## 3.0.0-alpha.69

### 小幅更新

- 改进 `diffUtility` 中的 `simplifyChanges` 行为。
- 启用 `simplifyChanges` 时，单字符词内编辑扩展至整词边界。
- 现在支持单字符的插入、删除和替换，使差异更易阅读。

## 3.0.0-alpha.68

### 修复更新

- 修正校对工作流流处理时抛出错误的问题。

## 3.0.0-alpha.67

### 重大更新

- 使用 Tiptap 位置工具进行位置映射。新版本需 Tiptap 3.12.0 及以上。
- 全新流处理实现，允许 AI 流式期间其他用户编辑文档。影响的操作包括：
  - tiptapEdit 工具
  - proofreaderWorkflow
  - tiptapEditWorkflow
  - streamText
  - streamHtml

### 小幅更新

- 新增 `AiCaret` 扩展，AI 流式操作时显示闪烁光标。
- 移除未用依赖：`@tiptap/y-tiptap` 和 `@tiptap-pro/extension-comments`

### 修复更新

- 修正文档更新时活动选择错误更新的问题。

## 3.0.0-alpha.66

### 修复更新

- 使 `smartInlineV2` 差异模式支持非内联且非区块元素，如表格单元格。

## 3.0.0-alpha.65

### 小幅更新

- 为 `diffUtility` 新增 `smartInlineV2` 差异模式。此模式改进了 `smartInline`，能正确展示区块元素（如表格）内的更改。

## 3.0.0-alpha.64

### 修复更新

- 避免使用旧版本不支持的 ProseMirror API，如 `toObject`。

## 3.0.0-alpha.63

### 小幅更新

- 为 `executeTool`、`streamTool` 和 `tiptapEditWorkflow` 新增 `tiptapEditHooks` 选项，允许在应用 Tiptap 编辑操作前拦截、修改或拒绝操作。`beforeOperation` 钩子接收操作上下文，返回 `BeforeOperationResult` 来控制操作应用及其修改。

## 3.0.0-alpha.62

### 重大更新

- 更新 Tiptap 编辑工具的 `selectableNodeTypes` 参数，默认允许 AI 选择并替换文档里任意块节点。

### 修复更新

- 移除评论工具操作中的 `console.log` 语句。

## 3.0.0-alpha.61

### 修复更新

- 改进 `createThread` 操作，避免极少情况线程创建点错误。
- 重构代码，减小包体积。

## 3.0.0-alpha.60

### 修复更新

- 修正 `editThreads` 工具及评论工作流中线程有时创建在错误位置的 Bug。

## 3.0.0-alpha.59

### 小幅更新

- 为 `editThreads` 工具新增带操作追踪的流式支持，操作通过计数在扩展存储追踪，防止流式中重复执行。工具调用 ID 变更时存储重置。
- 评论工作流新增流式支持。`editThreadsWorkflow` 增加 `isStreaming` 选项；为 true 时执行所有操作但不含最后一个，为 false 或未定义时执行全部（含最后一个）。操作同样通过计数追踪防止重复，工作流 ID 变更时存储重置。

### 修复更新

- 流式 HTML 内容时不再显示尾随 `<` 字符。

## 3.0.0-alpha.58

### 重大更新

- `executeTool` 和 `streamTool` 返回类型中 `output` 属性现返回 JSON 对象，方便日志记录及解析工具输出。

### 小幅更新

- 为 `diffUtility` 新增 `smartInline` 差异模式。该模式结合区块与内联比较，先识别变更区块，再在这些区块内执行字符级差异。适用于部分内容修改文档，实现效率与细节兼顾。

## 3.0.0-alpha.57

### 重大更新

- **破坏性变更**：重构 Tiptap 编辑实现，提升效率与准确性。移除 `HashAttributeExtension`，增强 schema 处理与哈希生成。
- **破坏性变更**：`tiptapRead` 方法返回类型中的 `nodeRange` 重命名为 `contentRange`，提升清晰度。
- **破坏性变更**：工作流用户提示中，将 `nodes` 输入属性改名为 `content`，影响 `tiptapEditWorkflow` 和 `editThreadsWorkflow`。请更新调用代码。

### 小幅更新

- 统一所有 Tiptap 方法中 `selectableNodeTypes` 处理。
- 将 `addHashesToDocument` 工具移动至 `tiptap-read` 目录，优化结构。

### 修复更新

- 修正评论工具中评论插入位置错误。
- 简化 `addHashesToDocument` 和 `shortHash` 中哈希生成。
- 简化 Tiptap 编辑函数中可选节点处理逻辑。

## 3.0.0-alpha.56

### 修复更新

- `getThreads` 分页改用 `threadIndexRange` 的排他上界。

## 3.0.0-alpha.55

### 修复更新

- 按线程索引分页 `getThreads` 输出，遵守块大小限制。

## 3.0.0-alpha.54

### 修复更新

- 修正接受或拒绝所有建议时偶发的“范围越界”错误。
- 修复“比较文档”功能修改结果反馈错误。

## 3.0.0-alpha.53

### 小幅更新

- 新增 `tiptapEditWorkflow` 方法，执行允许 AI 精确高效编辑文档的工作流。
- 新增 `editThreadsWorkflow` 方法，执行允许 AI 管理文档评论与线程的工作流。
- 新增 `getThreads` 方法，获取文档中所有线程及其评论和位置。

## 3.0.0-alpha.52

### 修复更新

- 修正接受或拒绝建议后其他建议位置未正确更新的问题。

## 3.0.0-alpha.51

### 重大更新

- **破坏性变更**：`editThreads` 工具采用全新更高效格式，新格式更快、更节省令牌，完全避免 diff 不匹配错误，显著提升准确性。

## 3.0.0-alpha.50

### 重大更新

- 简化建议 API，合并普通建议和“比较文档”更改为单一方法集。
- 移除“比较文档”功能中的 `acceptChange`、`rejectChange` 和 `rejectAllChanges`，改用 `acceptSuggestion`、`rejectSuggestion`、`acceptAllSuggestions` 和 `rejectAllSuggestions`，支持两类场景。
- 重命名 `applySuggestion` 为 `acceptSuggestion`，`applyAllSuggestions` 为 `acceptAllSuggestions`，保持一致性和清晰度。

### 小幅更新

- 为 `Suggestion` 接口新增 `reviewMode` 字段，指示建议处于“预览”或“审核”模式。该字段由 `reviewOptions.mode` 自动设置。
- 新增 `rejectSuggestion` 和 `rejectAllSuggestions` 用于拒绝建议，并返回 AI 针对拒绝更改的反馈。
- 修改 `acceptSuggestion` 和 `acceptAllSuggestions` 方法，返回包含用户接受或拒绝更改的 `aiFeedback`，含删除和插入内容及状态。反馈用于指导 AI 改进建议。

## 3.0.0-alpha.49

### 修复更新

- 用 `micro-memoize` 替换弃用的依赖 `moize`。
- 移除未使用依赖 `debounce`。

## 3.0.0-alpha.48

### 重大更新

- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.19`
- 移除已废弃的 `insertFragment` 方法。
- 移除已废弃的 `getActiveNodeRange` 和 `setActiveNodeRange` 方法。

### 小幅更新

- 新增 AI 工具包的 `proofreaderWorkflow` 方法，支持 AI 校对文档工作流。
- 新增 AI 工具包的 `tiptapRead` 方法，允许 AI 快速高效读取文档。

## 3.0.0-alpha.47

### 重大更新

- 新增并默认启用工具：`tiptapEdit`、`tiptapRead` 和 `tiptapReadSelection`。移除工具：`readNodeRange`、`readSelection`、`insertContent` 和 `applyPatch`。

## 3.0.0-alpha.46

### 小幅更新

- 新增实验性选用工具：`tiptapEdit`、`tiptapRead` 和 `tiptapReadSelection`，实现更快更高效编辑。

## 3.0.0-alpha.45

### 小幅更新

- 为 `diffUtility` 增加区块级差异对比选项。`mode` 参数可设置为 `block`，按顶级节点比较文档，适合只需知晓段落或标题变化且不追求字符细节的场景。

### 修复更新

- 修正 `diffUtility` 中使用 `changeMergeDistance` 时不同顶级节点相邻改动被错误合并的问题，确保不同块改动分离。
- 修复 `editThreads` 工具 Bug：未读取文档即创建线程，线程不会被创建。
- `startComparingDocuments` 中确保被比文档与主文档使用同一 schema。

## 3.0.0-alpha.44

### 小幅更新

- 新增 `setMarkdownSuggestions` 方法，支持通过比较 Markdown 内容与当前文档显示建议，需安装配置 Tiptap Markdown 扩展。
- 新增 `getMarkdownRange` 方法，提取文档指定范围 Markdown 内容，需安装配置 Tiptap Markdown 扩展。

### 修复更新

- 修正 `setHtmlSuggestions` 和 `setMarkdownSuggestions` 替换文本时错误修改 HTML 标签的问题。例如替换 "a" 为 "an" 不再误改 `<a>` 为 `<an>`，若删除文本不含 `<` 或 `>`，替换仅影响文本，标签不被改变。

## 3.0.0-alpha.43

### 修复更新

- 修复协作事务应用时装饰未正确更新的问题。

## 3.0.0-alpha.42

### 修复更新

- 修复协作事务应用时装饰未正确更新的问题。

## 3.0.0-alpha.41

### 重大更新

- 使用 `diffUtilityConfig` 替代 `changeMergeDistance`，支持更丰富的文档比较定制。

### 小幅更新

- 在 `setSuggestions` 的 `compareDocuments` 格式中新增 `diffUtilityConfig` 选项，可定制文档比较工具。
- 在 `Suggestion` 类型的 `displayOptions` 中增加 `diffAttributes`，允许自定义差异装饰属性。

## 3.0.0-alpha.40

### 修复更新

- 修正文档更新后 AI 读取错误文档内容的问题。

## 3.0.0-alpha.39

### 修复更新

- 修复新线程和评论未正确创建于文档位置的 Bug。

## 3.0.0-alpha.38

### 修复更新

- 修复 `applyPatch` 和 `insertContent` 工具流式处理时未正确工作的 Bug。

## 3.0.0-alpha.37

### 重大更新

- `applyPatch` 工具采用全新格式，显著提升速度与准确性。
- 改进所有内置工具输入输出格式及工具定义。
- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.11`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.14`
  - `@tiptap-pro/ai-toolkit-anthropic@3.0.0-alpha.6`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.10`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.9`

## 3.0.0-alpha.36

### 重大更新

- 使 `insertContent` 工具的内容格式独立，将原 `"html"` 属性重命名为 `"content"`。
- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.10`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.13`
  - `@tiptap-pro/ai-toolkit-anthropic@3.0.0-alpha.5`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.9`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.8`

### 修复更新

- 修复 `insertContent` 工具中 `activeNodeRange` 位置无效问题。
- 修复 `insertContent` 导致 `activeNodeRange` 总重置为 0 的问题。
- 修正 `setHtmlSuggestions` 边界错误及格式丢失。边界使用 `content.size` 替代 `nodeSize - 1`，应用建议时保留 HTML 格式（加粗、斜体、链接等）。

## 3.0.0-alpha.35

### 修复更新

- 修复 `streamText` 和 `streamHtml` 方法中不必要将 `ReadableStream` 转为 `AsyncIterable` 导致性能下降的问题。

## 3.0.0-alpha.34

### 小幅更新

- 为 `diffUtility`、`startComparingDocuments`、`setSuggestions`（`compareDocuments` 格式）、`setHtmlSuggestions` 及所有编辑方法的 `reviewOptions` 添加 `changeMergeDistance` 参数，允许合并相近改动，设定最大改动间文档距离做合并。
- 为 `setHtmlSuggestions` 新增 `reviewOptions` 参数，支持用户定制建议显示选项（如 `diffPosition`、`showAsDiff`、自定义 `renderDecorations`）以及添加自定义元数据，模式与其他编辑方法一致。
- 修正 `setHtmlSuggestions` 无 `range` 参数时偏移计算，确保建议高亮准确，修复位置偏移 -1 的 Bug。
- 修正 `setHtmlSuggestions` 默认 `diffPosition` 为 'after'，支持通过 `reviewOptions.displayOptions.diffPosition` 配置。

## 3.0.0-alpha.33

### 小幅更新

- 新增 `getSelectedSuggestion` 方法，用于获取当前选中的建议。

## 3.0.0-alpha.32

### 小幅更新

- 新增 `setActiveSelection` 方法，用于设置活动选择区域，覆盖工具如 `readSelection` 读取的当前编辑器选择。

## 3.0.0-alpha.31

### 小幅更新

- `executeTool` 和 `streamTool` 中新增 `commentsOptions` 属性，允许传递自定义数据至线程和评论操作。`data` 用于线程数据（`editor.commands.setThread`），`commentData` 用于评论数据（`editor.commands.createComment` 和 `editor.commands.setThread`）。

## 3.0.0-alpha.30

### 修复更新

- 修复节点属性变更未被正确检测的问题。
- 在实时比较文档时忽略 Unique ID 扩展的改动。
- 在实时比较文档时忽略 Comments 扩展的改动。

## 3.0.0-alpha.29

### 小幅更新

- 新增 `setHtmlSuggestions` 方法，通过比较 HTML 内容与当前文档显示建议。

## 3.0.0-alpha.28

### 修复更新

- 修复因错误导入导致打包失败的问题。

## 3.0.0-alpha.27

### 修复更新

- 修复 `createThread` 操作中线程偶尔创建于错误位置的 Bug。
- 优化 `createThread` 失败时，AI 接收的错误信息。

## 3.0.0-alpha.26

### 重大更新

- 新增基于 AI 的评论和线程管理工具 `editThreads` 和 `getThreads`。
- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.9`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.12`
  - `@tiptap-pro/ai-toolkit-anthropic@3.0.0-alpha.4`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.8`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.7`

## 3.0.0-alpha.25

### 修复更新

- 修复 `applyPatch` 流式处理导致最后操作未正确解析回退，防止文本流式内容逐渐消失的问题。

## 3.0.0-alpha.24

### 重大更新

- 将 `applyDiff` 工具重命名为 `applyPatch`。
- 将 `applyHtmlDiff` 重命名为 `applyHtmlPatch`。
- 改进 `applyDiff`（现名 `applyPatch`）格式及定义，使 AI 生成补丁操作列表更准确、避免无效跳转，显著降低令牌消耗。
- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.8`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.11`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.7`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.6`
  - `@tiptap-pro/ai-toolkit-anthropic@3.0.0-alpha.3`

## 3.0.0-alpha.23

### 小幅更新

- `insertContent` 工具新增 `activeNodeRange` 位置，允许 AI 在活动节点范围内插入内容。禁用 `applyDiff` 工具时提升编辑准确率。
- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.7`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.10`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.6`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.5`
  - `@tiptap-pro/ai-toolkit-anthropic@3.0.0-alpha.2`

## 3.0.0-alpha.22

### 小幅更新

- 扩展配置新增 `addHtmlSchemaAwareness` 方法，为自定义 Node 或 Mark 扩展提供 schema 识别数据。

## 3.0.0-alpha.21

### 修复更新

- 修正流式显示详细差异导致差异持续更新，现仅在流结束时显示详细差异。
- 修正流式内容开头插入多余段落的问题。

## 3.0.0-alpha.20

### 重大更新

- 将 `getSchemaAwareness` 改名为 `getHtmlSchemaAwareness`。
- 优化 schema 识别提示语，使 AI 模型更加准确。

## 3.0.0-alpha.19

### 小幅更新

- 实验性实现 AI 工具包与 Pages 扩展集成，新增 `readPage` 工具。

## 3.0.0-alpha.18

### 修复更新

- 使 `streamHtml` 和 `streamText` 方法返回在流结束时 resolve 的 Promise。

## 3.0.0-alpha.17

### 重大更新

- 优化 `readSelection` 和 `insertContent` 工具定义，修复因用户修改选区导致 AI 插入位置错误的 Bug。

### 修复更新

- 修复 `streamHtml` 和 `streamText` 方法不支持 `ReadableStream` 参数的问题。

## 3.0.0-alpha.16

### 重大更新

- 在审核选项中将 `detailedDiff` 重命名为 `diffMode`，用于控制原文与修改内容差异的显示方式。

## 3.0.0-alpha.15

### 重大更新

- 审核选项新增 `detailedDiff`，控制是否以详细差异形式展示更改。将原 `showDiff` 选项改名为 `detailedDiff`，语义更清晰。
- 工具执行和流处理选项中新增 `detailedDiff`，默认值为 `true`，使更改默认以详细差异形式显示。

## 3.0.0-alpha.14

### 重大更新

- 需升级以下提供者库至指定版本或更高：
  - `@tiptap-pro/ai-toolkit-tool-definitions@3.0.0-alpha.4`
  - `@tiptap-pro/ai-toolkit-ai-sdk@3.0.0-alpha.7`
  - `@tiptap-pro/ai-toolkit-langchain@3.0.0-alpha.3`
  - `@tiptap-pro/ai-toolkit-openai@3.0.0-alpha.2`
- 移除 `executeTool` 的 `currentChunk` 参数及返回字段。
- 新增 `getActiveNodeRange` 方法，获取活动节点范围，用以替代旧的 `currentChunk`，提升编辑准确性。
- 新增 `setActiveNodeRange` 方法，设置活动节点范围。
- 移除 `readFirstChunk`、`readNextChunk`、`readPreviousChunk` 工具。
- 新增 `readNodeRange` 工具，允许 AI 读取任意顶级节点范围，灵活度更高。

### 小幅更新

- 新增 `streamTool` 方法，支持向编辑器流式输入工具调用的结果。

## 3.0.0-alpha.13

### 小幅更新

- 审核选项新增 `metadata`，允许附加自定义元数据和属性。
- 新增 `streamText` 和 `streamHtml` 方法，支持向编辑器流式输入文本和 HTML。

### 修复更新

- 修复 `insertJson` 不支持 ProseMirror Fragment Tiptap JSON 的问题。
- 修复建议差异视图显示多余元素（如多余段落）的错误。

## 3.0.0-alpha.12

### 修复更新

- 编辑器未安装 AiToolkit 扩展时调用 `getAiToolkit` 显示警告。
- 修复 `getJsonChunks` 未正确返回 JSON 块格式。
- 改进 `readFirstChunk` 的响应格式。

## 3.0.0-alpha.11

### 修复更新

- 修复 `diffUtility` 错误地认定两个完全相同的空文档为不同的问题。

## 3.0.0-alpha.10

### 重大更新

- 新增 `replaceDocumentWhereChanged` 方法，支持高效替换整个文档，仅替换发生改变的部分，避免全内容标记为替换。
- 重写 `applyHtmlDiff` 和 `rejectAllChanges`，内部基于 `replaceDocumentWhereChanged` 实现。

## 3.0.0-alpha.9

### 重大更新

- 新增 `rejectAllChanges` 方法，用于实时文档比较时一次性拒绝所有更改。

## 3.0.0-alpha.8

### 重大更新

- 新增 `acceptChange` 和 `rejectChange` 方法，用于实时文档比较时接受或拒绝单个更改。
- 移除 `applySuggestionToOtherDoc`，因功能与 `acceptChange` 重复且命名易混淆。

## 3.0.0-alpha.7

### 重大更新

- 优化分块格式，包含分块的范围信息。
- 提升 `getHtmlRange`、`getJsonRange` 和 `getTextRange` 返回分块索引的准确度。

## 3.0.0-alpha.6

### 修复更新

- 修复错误导入问题。

## 3.0.0-alpha.5

### 小幅更新

- 新增 `applySuggestionToOtherDoc` 方法，用于实时比较文档时将建议应用于另外文档。
- 初次调用 `startComparingDocuments` 时忽略防抖超时，提升响应速度。

## 3.0.0-alpha.4

### 重大更新

- 移除 `executeTool` 返回值中的 `needsReview`，替换为 `docChanged`。
- 当工具修改文档时，`docChanged` 设置为 `true`。

## 3.0.0-alpha.3

### 小幅更新

- 在 `executeTool` 返回类型中新增 `needsReview` 字段，标识调用是否需要用户审核。
- 新增一次性应用所有建议的 `applyAllSuggestions` 方法。
- 优化工具调用失败时的错误提示。

## 3.1.0-alpha.2

### 修复更新

- 修复 `executeTool` 参数中 `input` 类型以兼容 Vercel AI SDK。

## 3.1.0-alpha.1

### 重大更新

- AI 工具包初始 alpha 版发布。