---
title: 服务器评论
meta:
  title: 服务器评论 | Tiptap 服务器 AI 工具包
  description: 使用服务器 AI 工具包，启用服务器端 AI 代理读取和编辑 Tiptap 文档中的评论。
  category: 内容 AI
sidebars:
  hideSecondary: true
---

import { Callout } from '@/components/ui/Callout'
import { CodeDemo } from '@/components/CodeDemo'

赋予您的 AI 代理读取、编写和编辑文档中评论的能力，完全在服务器端完成。

<CodeDemo isLarge path="" isScrollable src="https://ai-toolkit-demos.vercel.app/server-comments" />

查看 [GitHub 上的源码](https://github.com/ueberdosis/ai-toolkit-demos)。

<Callout title="实验性功能" variant="warning">
  此功能处于实验阶段，API 未来版本可能会发生变化。
</Callout>

<Callout title="AI 代理聊天机器人指南的延续" variant="info">
  本指南是[AI 代理聊天机器人指南](/content-ai/capabilities/server-ai-toolkit/agents/ai-agent-chatbot)的延续，请先阅读该指南。
</Callout>

## 启用评论工具

要启用评论工具，获取服务器 AI 工具包 API 的工具定义时，传递 `getThreads` 和 `editThreads` 选项。

```ts
const response = await fetch(`${apiBaseUrl}/toolkit/tools`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    Authorization: `Bearer ${jwtToken}`,
    'X-App-Id': appId,
  },
  body: JSON.stringify({
    schemaAwarenessData,
    tools: {
      // 禁用 tiptap 编辑工具，使 AI 不能编辑文档，
      // 只能添加评论
      tiptapEdit: false,
      // 启用评论工具
      getThreads: true,
      editThreads: true,
    },
  }),
})
```

## 执行评论工具

评论工具需要一个 **Tiptap Cloud 文档**，因为线程和评论存储在 Tiptap 文档服务器上。使用 `experimental_documentOptions` 时，**不需要传递 `document` 字段** —— AI 服务器会自动从文档服务器获取。

### JWT 要求

您的 JWT 必须包含文档服务器的凭证作为声明：

- `experimental_document_app_id`（`string`）：文档服务器的 Tiptap Cloud 应用 ID
- `experimental_document_secret`（`string`）：文档服务器的管理员 API 密钥

### 请求体

在请求体中包含 `experimental_documentOptions`：

- `documentId`（`string`，必填）：文档 ID
- `userId`（`string`，可选）：创建评论的用户 ID。如果省略，则评论将不带用户归属创建。

可选包含 `experimental_commentsOptions` 以添加元数据：

- `threadData`（`Record<string, any>`，可选）：使用 `editThreads` 工具创建的新线程附加的元数据。
- `commentData`（`Record<string, any>`，可选）：使用 `editThreads` 工具创建的新评论附加的元数据。

```ts
// JWT 必须包含文档服务器凭证
import jwt from 'jsonwebtoken'

const jwtToken = jwt.sign(
  {
    // 文档服务器凭证（评论工具必需）
    experimental_document_app_id: 'your-document-app-id',
    experimental_document_secret: 'your-document-api-secret',
  },
  TIPTAP_CLOUD_AI_SECRET,
  { expiresIn: '1h' },
)

const result = await fetch(`${apiBaseUrl}/toolkit/execute-tool`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    Authorization: `Bearer ${jwtToken}`,
    'X-App-Id': appId,
  },
  body: JSON.stringify({
    toolName: 'editThreads',
    input: {},
    schemaAwarenessData,
    // 引用 Tiptap Cloud 文档
    experimental_documentOptions: {
      documentId: '123',
      userId: 'ai-assistant',
    },
    // 可选元数据
    experimental_commentsOptions: {
      threadData: { source: 'ai' },
      commentData: { source: 'ai' },
    },
  }),
})
```

## 最终效果

结果是一个简单但完善的 AI 聊天机器人应用：

<CodeDemo isLarge path="" isScrollable src="https://ai-toolkit-demos.vercel.app/server-comments" />

查看 [GitHub 上的源码](https://github.com/ueberdosis/ai-toolkit-demos)。

## 下一步

- 了解所有可用的[工具定义](/content-ai/capabilities/server-ai-toolkit/agents/tools)
- 探索[REST API 参考](/content-ai/capabilities/server-ai-toolkit/api-reference/rest-api)