---
title: 建议工具
meta:
  title: 建议工具 | Tiptap 编辑器文档
  description: 使用提及和表情符号等节点自定义自动补全建议。在我们的文档中探索设置和配置。
  category: 编辑器
tags:
  - type: image
    src: https://img.shields.io/npm/v/@tiptap/suggestion?label=version
    url: https://www.npmjs.com/package/@tiptap/suggestion
    label: 版本
  - type: image
    src: https://img.shields.io/npm/dm/@tiptap/suggestion?label=version
    url: https://npmcharts.com/compare/@tiptap/suggestion
    label: 下载量
---

此工具帮助处理编辑器中的各种建议。查看 [`Mention`](/editor/extensions/nodes/mention) 或 [`Emoji`](/editor/extensions/nodes/emoji) 节点以查看其实际效果。

## 设置

### char

触发自动补全弹出窗口的字符。

默认：`'@'`

### pluginKey

一个 ProseMirror PluginKey。

默认：`SuggestionPluginKey`

### allow

一个返回布尔值的函数，指示建议是否应处于活动状态。

默认：`(props: { editor: Editor; state: EditorState; range: Range, isActive?: boolean }) => true`

### shouldShow

一个返回布尔值的函数，用于指示建议是否应处于激活状态。这对于防止在协作环境中远程用户触发建议弹窗非常有用。

```js
shouldShow: ({ editor, range, query, text, transaction }) => {
  return isChangeOrigin(transaction)
}
```

默认：`null`

### allowSpaces

允许或不允许建议项目中出现空格。

默认：`false`

### allowedPrefixes

允许触发建议的前缀字符。设置为 `null` 以允许任何前缀字符。

默认：`[' ']`

### startOfLine

仅在行首触发自动补全弹出窗口。

默认：`false`

### decorationTag

应为建议呈现的 HTML 标签。

默认：`'span'`

### decorationClass

应添加到建议的 CSS 类。

默认: `'suggestion'`

### decorationContent

应在建议装饰中呈现的内容。

默认: `''`

### decorationEmptyClass

当建议为空时应添加的 CSS 类。

默认: `'is-empty'`

### command

选择建议时执行的操作。

默认：`() => {}`

### items

传递一个过滤后的建议数组，可以是异步的。

默认：`({ editor, query }) => []`

### render

自动补全弹出窗口的渲染函数。

默认：`() => ({})`

### findSuggestionMatch

可选参数，用于替换触发建议的编辑器内容内置正则匹配。  
有关更多详细信息，请参见 [源代码](https://github.com/ueberdosis/tiptap/blob/main/packages/suggestion/src/findSuggestionMatch.ts#L18)。

默认：`findSuggestionMatch(config: Trigger): SuggestionMatch`

## 关闭打开的建议

有时你希望用户能够在不选择项目的情况下退出打开的建议。  
为实现这一点，用户可以按下 Escape 键，这将关闭打开的建议。  
如果你想手动触发关闭建议，可以使用 `exitSuggestion` 工具函数来关闭视图中现有的建议。

```js
import { exitSuggestion } from '@tiptap/suggestion'
import { PluginKey } from 'prosemirror-state' // 可选，如果你需要创建自定义的 key

const MySuggestionPluginKey = new PluginKey('my-suggestions') // 或使用默认的 'suggestion'

exitSuggestion(editor.view, MySuggestionPluginKey)

// 或者，使用默认的插件 key：
// exitSuggestion(editor.view, 'suggestion')
```

## Collaboration

当在协作环境中使用 Tiptap 时，你可能会注意到当某个用户触发建议（如提及）时，建议会对所有用户弹出。这是因为文档更改被同步到所有客户端，每个客户端的建议插件都会对该更改作出反应。

为防止这种情况，可以使用 `shouldShow` 选项结合来自 `@tiptap/extension-collaboration` 的 `isChangeOrigin` 辅助函数。

```js
import { isChangeOrigin } from '@tiptap/extension-collaboration'

Suggestion({
  // …
  shouldShow: ({ transaction }) => {
    return isChangeOrigin(transaction)
  },
})
```

通过返回 `isChangeOrigin(props.transaction)`，建议仅在当前用户发起更改时激活。

## 源代码

[packages/suggestion/](https://github.com/ueberdosis/tiptap/blob/main/packages/suggestion/)